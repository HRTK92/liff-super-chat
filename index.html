<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LINE スパチャ</title>
</head>

<body>
    <label for="yen">金額:</label>
    <input type="number" name="円" id="yen">
    <br>
    <label for="contents">内容:</label>
    <textarea rows="10" id="contents"></textarea>
    <input type="button" value="送信" id="send">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"
        integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script charset="utf-8" src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <script>
        ; (function () {
            var src = '//cdn.jsdelivr.net/npm/eruda';
            if (!/eruda=true/.test(window.location) && localStorage.getItem('active-eruda') != 'true') return;
            document.write('<scr' + 'ipt src="' + src + '"></scr' + 'ipt>');
            document.write('<scr' + 'ipt>eruda.init();</scr' + 'ipt>');
        })();
    </script>
    <script>
        liff.init({
            liffId: '1655627652-WxxyaNqw', // Use own liffId
        })
            .then(() => {
                if (!liff.isLoggedIn()) {
                    liff.login();
                }
                const idToken = liff.getDecodedIDToken();
                window.idToken = idToken
                //console.log(idToken);
            })
            .catch((err) => {
                alert(err);
            });
        $('#send').on('click', function () {
            var yen = $('#yen').val()
            var contents = $('#contents').val()
            var color = ["#cc0000", "#ff0000"]
            liff.sendMessages([{
                "type": "flex",
                "altText": `${window.idToken["name"]}さんがスーパーキャットをしました。`,
                "contents": {
                    "type": "bubble",
                    "header": {
                        "type": "box",
                        "layout": "vertical",
                        "contents": [
                            {
                                "type": "box",
                                "layout": "baseline",
                                "contents": [
                                    {
                                        "type": "icon",
                                        "url": window.idToken["picture"]
                                    },
                                    {
                                        "type": "text",
                                        "text": window.idToken["name"],
                                        "color": "#ffffff",
                                        "weight": "bold",
                                        "size": "md"
                                    }
                                ],
                                "margin": "none",
                                "spacing": "none"
                            },
                            {
                                "type": "text",
                                "text": "¥" + yen,
                                "color": "#ffffff"
                            }
                        ],
                        "backgroundColor": color[0]
                    },
                    "body": {
                        "type": "box",
                        "layout": "vertical",
                        "contents": [
                            {
                                "type": "text",
                                "size": "lg",
                                "text": contents,
                                "color": "#ffffff",
                                "wrap": true
                            }
                        ],
                        "backgroundColor": color[1]
                    }
                }
            }])
                .then(function () {
                    liff.closeWindow();
                }).catch(function (error) {
                    alert(error);
                });
        });
    </script>
</body>

</html>